<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>State stores &mdash; Streamiz.Kafka.Net  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Test topology driver" href="topology-test-driver.html" />
    <link rel="prev" title="Stateful processors" href="stateful-processors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Streamiz.Kafka.Net
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Streamiz.Kafka.Net</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="stream-configuration.html">Configuring a Stream Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading-model.html">Threading model</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateless-processors.html">Stateless processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="stateful-processors.html">Stateful processors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">State stores</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-memory-key-value-store">In Memory key/value store</a></li>
<li class="toctree-l2"><a class="reference internal" href="#in-memory-window-store">In Memory window store</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rocksdb-key-value-store">RocksDb key/value store</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rocksdb-window-store">RocksDb window store</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caching">Caching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-caching">Configuring Caching</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#remote-storage">Remote storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#custom-state-store">Custom state store</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azure-table-key-value-store">Azure Table Key/Value store</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to">How to ?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topology-test-driver.html">Test topology driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring Stream Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="async-processing.html">Asynchronous processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="processor-api.html">Processor API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Streamiz.Kafka.Net</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">State stores</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/stores.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="state-stores">
<h1>State stores<a class="headerlink" href="#state-stores" title="Link to this heading"></a></h1>
<p>⚠️ <span style="color:red"><strong>Some things you need to know</strong></span> ⚠️</p>
<ul class="simple">
<li><p>From 1.4.0 release, the default state store is a RocksDb state store. (Before 1.4.0, the default state store was a in memory state store.)</p></li>
<li><p>RocksDb state store is available from 1.2.0 release.</p></li>
<li><p>By default, a state store is tracked by a changelog topic from 1.2.0 release. (If you don’t need, you have to make it explicit).</p></li>
</ul>
<section id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Link to this heading"></a></h2>
<p>A stateful processor may use one or more state stores. Each task that contains a stateful processor has exclusive access to the state stores in the processor. That means a topology with two state stores and five input partitions will lead to five tasks, and each task will own two state stores resulting in 10 state stores in total for your Kafka Streams application.</p>
<p>State stores in Streamiz are layered in four ways :</p>
<ul class="simple">
<li><p>The outermost layer collects metrics about the operations on the state store and serializes and deserializes the records that are written to and read from the state store.</p></li>
<li><p>The next layer caches the records. If a record exists in the cache with the same key as a new record, the cache overwrites the existing record with the new record; otherwise, the cache adds a new entry for the new record. The cache is the primary serving area for lookups. If a lookup can’t find a record with a given key in the cache, it is forwarded to the next layer. If this lookup returns an entry, the entry is added to the cache. If the cache exceeds its configured size during a write, the cache evicts the records that have been least recently used and sends new and overwritten records downstream. The caching layer decreases downstream traffic because no updates are sent downstream unless the cache evicts records or is flushed. The cache’s size is configurable. If it is set to zero, the cache is disabled. (<code class="docutils literal notranslate"><span class="pre">EARLY</span> <span class="pre">ACCESS</span> <span class="pre">ONLY</span></code>)</p></li>
<li><p>The changelogging layer sends each record updated in the state store to a topic in Kafka—the state’s changelog topic. The changelog topic is a compacted topic that replicates the data in the local state. Changelogging is needed for fault tolerance, as we will explain below.</p></li>
<li><p>The innermost layer updates and reads the local state store.</p></li>
</ul>
<p><img alt="state-store" src="_images/state-store.png" /></p>
</section>
<section id="in-memory-key-value-store">
<h2>In Memory key/value store<a class="headerlink" href="#in-memory-key-value-store" title="Link to this heading"></a></h2>
<p>As his name, this is an inmemory key value state store which is supplied by InMemoryKeyValueBytesStoreSupplier.
You have an child materialized class to help you to use it.</p>
<p>Usefull with statefull operation like Count, Aggregate, Reduce but also to materialized IKTable&lt;K, V&gt; or IGlobalKTable&lt;K, V&gt;</p>
<p>Example :</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;test-ktable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">InMemory</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;test-store&quot;</span><span class="p">));</span>

<span class="n">builder</span>
<span class="w">        </span><span class="p">.</span><span class="n">Stream</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">GroupBy</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span>
<span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0L</span><span class="p">,</span>
<span class="w">            </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="n">InMemory</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;agg-store&quot;</span><span class="p">).</span><span class="n">WithValueSerdes</span><span class="o">&lt;</span><span class="n">Int64SerDes</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Be carefull, this state store is not persistent ! So after each application restart, you loose the state of your state store.</strong></p>
</section>
<section id="in-memory-window-store">
<h2>In Memory window store<a class="headerlink" href="#in-memory-window-store" title="Link to this heading"></a></h2>
<p>As his name, this is an inmemory windows state store which is supplied by InMemoryWindowStoreSupplier.
You have an child materialized class to help you to use it.</p>
<p>Usefull with windowing statefull operation like Count, Aggregate, Reduce in ITimeWindowedKStream&lt;K, V&gt;</p>
<p>Example :</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span>
<span class="w">        </span><span class="p">.</span><span class="n">Stream</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">GroupByKey</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">WindowedBy</span><span class="p">(</span><span class="n">TumblingWindowOptions</span><span class="p">.</span><span class="n">Of</span><span class="p">(</span><span class="mi">2000</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span>
<span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">),</span>
<span class="w">            </span><span class="n">InMemoryWindows</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">).</span><span class="n">WithValueSerdes</span><span class="o">&lt;</span><span class="n">Int32SerDes</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">ToStream</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">To</span><span class="o">&lt;</span><span class="n">StringTimeWindowedSerDes</span><span class="p">,</span><span class="w"> </span><span class="n">Int32SerDes</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Be carefull, this state store is not persistent ! So after each application restart, you loose the state of your state store.</strong></p>
</section>
<section id="rocksdb-key-value-store">
<h2>RocksDb key/value store<a class="headerlink" href="#rocksdb-key-value-store" title="Link to this heading"></a></h2>
<p>As his name, this is a rocksdb key value state store which is supplied by RocksDbKeyValueBytesStoreSupplier.</p>
<p>The state store is persisted on disk at <code class="docutils literal notranslate"><span class="pre">{config.StateDir}/{config.ApplicationId}/{taskId}/rocksdb/{store.Name}</span></code>.</p>
<p>You have an child materialized class to help you to use it.</p>
<p>Usefull with statefull operation like Count, Aggregate, Reduce but also to materialized IKTable&lt;K, V&gt; or IGlobalKTable&lt;K, V&gt;</p>
<p>Example :</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;test-ktable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RocksDb</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;test-store&quot;</span><span class="p">));</span>

<span class="w"> </span><span class="n">builder</span>
<span class="w">    </span><span class="p">.</span><span class="n">Stream</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">GroupBy</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span>
<span class="w">        </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0L</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="n">RocksDb</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;agg-store&quot;</span><span class="p">).</span><span class="n">WithValueSerdes</span><span class="o">&lt;</span><span class="n">Int64SerDes</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="rocksdb-window-store">
<h2>RocksDb window store<a class="headerlink" href="#rocksdb-window-store" title="Link to this heading"></a></h2>
<p>As his name, this is a rocksdb windows state store which is supplied by RocksDbWindowBytesStoreSupplier.</p>
<p>This state store save data in 3 segments, each segment is a rocksdb properly and contains certain time range. This for optimization purposes and for retention periods (window size + grace + window-additional-retention).</p>
<p>You have an child materialized class to help you to use it.</p>
<p>Usefull with windowing statefull operation like Count, Aggregate, Reduce in ITimeWindowedKStream&lt;K, V&gt;</p>
<p>Example :</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span>
<span class="w">        </span><span class="p">.</span><span class="n">Stream</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;topic&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">GroupByKey</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">WindowedBy</span><span class="p">(</span><span class="n">TumblingWindowOptions</span><span class="p">.</span><span class="n">Of</span><span class="p">(</span><span class="mi">2000</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span>
<span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span><span class="w"> </span><span class="n">agg</span><span class="p">),</span>
<span class="w">            </span><span class="n">RocksDbWindows</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">).</span><span class="n">WithValueSerdes</span><span class="o">&lt;</span><span class="n">Int32SerDes</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">ToStream</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">To</span><span class="o">&lt;</span><span class="n">StringTimeWindowedSerDes</span><span class="p">,</span><span class="w"> </span><span class="n">Int32SerDes</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Link to this heading"></a></h2>
<p><strong>This feature is available in <code class="docutils literal notranslate"><span class="pre">EARLY</span> <span class="pre">ACCESS</span></code> only.</strong></p>
<p>Streamiz offers robust capabilities for stream processing applications, including efficient data caching mechanisms. Caching optimizes performance by minimizing redundant computations, reducing latency, and enhancing overall throughput within stream processing pipelines.</p>
<p><strong>Purpose of Caching</strong></p>
<p>Caching in Streamiz serves several key purposes:</p>
<ul class="simple">
<li><p><strong>Reduction of Redundant Computations</strong>: Stores intermediate results to avoid recomputing data unnecessarily.</p></li>
<li><p><strong>Performance Optimization</strong>: Minimizes latency by reducing the need for repeated expensive computations or data fetches.</p></li>
<li><p><strong>Fault Tolerance</strong>: Ensures resilience by maintaining readily accessible intermediate results for recovery during failures.</p></li>
</ul>
<p><strong>Types of Caching</strong></p>
<p>Streamiz supports one primary type of caching:</p>
<ol class="simple">
<li><p><strong>State Store Cache</strong>: Enhances processing efficiency by caching state store entries, reducing the overhead of state fetches and updates.</p></li>
</ol>
<section id="configuring-caching">
<h3>Configuring Caching<a class="headerlink" href="#configuring-caching" title="Link to this heading"></a></h3>
<p>To optimize caching behavior, Streamiz offers configurable parameters:</p>
<ul class="simple">
<li><p><strong>Cache Size</strong>: Defines the maximum size of the cache to balance performance and memory usage. To be fair, this cache size is the maximum cache size per state store.</p></li>
<li><p><strong>Enable caching</strong> : By default, caching is disabled for all stateful processors in Streamiz. <strong>This feature will be enabled by default soon.</strong> You can enable the caching feature with <code class="docutils literal notranslate"><span class="pre">InMemory.WithCachingEnabled()</span></code>, <code class="docutils literal notranslate"><span class="pre">InMemoryWindows.WithCachingEnabled()</span></code>, <code class="docutils literal notranslate"><span class="pre">RocksDb.WithCachingEnabled()</span></code> or <code class="docutils literal notranslate"><span class="pre">RocksDbWindows.WithCachingEnabled()</span></code></p></li>
</ul>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Enable caching for a rocksdb window store</span>
<span class="n">RocksDbWindows</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;count-window-store&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithKeySerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringSerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithValueSerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Int64SerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithCachingEnabled</span><span class="p">();</span>

<span class="c1">// Enable caching for an in-memory window store</span>
<span class="n">InMemoryWindows</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;count-window-store&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithKeySerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringSerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithValueSerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Int64SerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithCachingEnabled</span><span class="p">();</span>

<span class="c1">// Enable caching for an rocksdb key/value store</span>
<span class="n">RocksDb</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;count-store&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithKeySerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringSerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithValueSerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Int64SerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithCachingEnabled</span><span class="p">();</span>

<span class="c1">// Enable caching for an in-memory key/value store</span>
<span class="n">InMemory</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;count-store&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithKeySerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringSerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithValueSerdes</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Int64SerDes</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithCachingEnabled</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>
<section id="remote-storage">
<h2>Remote storage<a class="headerlink" href="#remote-storage" title="Link to this heading"></a></h2>
<p>Steamiz provides powerful capabilities for real-time stream processing applications, leveraging Kafka as a robust event streaming platform. One of its key features is the ability to manage and store stateful data, crucial for maintaining application state across stream processing operations. While Steamiz offers built-in state stores like RocksDB, In memory store, developers may sometimes need to create custom state stores tailored to specific use cases or integration requirements.</p>
<p>Custom state stores can be beneficial for scenarios such as integrating with existing systems, enhancing performance for specific data access patterns, or ensuring compatibility with proprietary data formats.</p>
<section id="custom-state-store">
<h3>Custom state store<a class="headerlink" href="#custom-state-store" title="Link to this heading"></a></h3>
<p><strong>Steps to Create Custom State Stores</strong></p>
<p>1- Implement the State Store</p>
<p>Create a class that extends <code class="docutils literal notranslate"><span class="pre">IKeyValueStore&lt;Bytes,</span> <span class="pre">byte[]&gt;</span></code> depending on the nature of your state. This involves defining how the state is stored and accessed. Consider using technologies like in-memory data structures or external databases depending on your use case.</p>
<p>For instance:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomKeyValueStore</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IKeyValueStore</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Name of this store</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Return if the storage is persistent or not.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">Persistent</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Return if the storage is present locally or not.</span>
<span class="w">        </span><span class="c1">/// If the store is local, an internal kafka topic will be created to offload the data</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsLocally</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Is this store open for reading and writing</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsOpen</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Constructor with client parameters ..</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="nf">CustomKeyValueStore</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">                </span><span class="c1">// doing something with uri, token etc ..</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Initializes this state store.</span>
<span class="w">        </span><span class="c1">/// The implementation of this function must register the root store in the context via the</span>
<span class="w">        </span><span class="c1">/// &lt;see cref=&quot;ProcessorContext.Register(IStateStore, Internal.StateRestoreCallback)&quot;/&gt; function, where the</span>
<span class="w">        </span><span class="c1">/// first &lt;see cref=&quot;IStateStore&quot;/&gt; parameter should always be the passed-in &lt;code&gt;root&lt;/code&gt; object, and</span>
<span class="w">        </span><span class="c1">/// the second parameter should be an object of user&#39;s implementation</span>
<span class="w">        </span><span class="c1">/// of the &lt;see cref=&quot;Internal.StateRestoreCallback&quot;/&gt; interface used for restoring the state store from the changelog.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;context&quot;&gt;Processor context&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;root&quot;&gt;Root state (always itself)&lt;/param&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Init</span><span class="p">(</span><span class="n">ProcessorContext</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">IStateStore</span><span class="w"> </span><span class="n">root</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Flush any cached data</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Flush</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Close the storage engine.</span>
<span class="w">        </span><span class="c1">/// Note that this function needs to be idempotent since it may be called</span>
<span class="w">        </span><span class="c1">/// several times on the same state store</span>
<span class="w">        </span><span class="c1">/// Users only need to implement this function but should NEVER need to call this api explicitly</span>
<span class="w">        </span><span class="c1">/// as it will be called by the library automatically when necessary</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Close</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Get the value corresponding to this key.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;key&quot;&gt;the key to fetch&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;The value or null if no value is found.&lt;/returns&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">Get</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="n">key</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Get an enumerator over a given range of keys. This enumerator must be closed after use.</span>
<span class="w">        </span><span class="c1">/// Order is not guaranteed as bytes lexicographical ordering might not represent key order.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;from&quot;&gt;The first key that could be in the range, where iteration starts from.&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;to&quot;&gt;The last key that could be in the range, where iteration ends.&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;The enumerator for this range, from smallest to largest bytes.&lt;/returns&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IKeyValueEnumerator</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Range</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="k">from</span><span class="p">,</span><span class="w"> </span><span class="n">Bytes</span><span class="w"> </span><span class="n">to</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Get a reverser enumerator over a given range of keys. This enumerator must be closed after use.</span>
<span class="w">        </span><span class="c1">/// Order is not guaranteed as bytes lexicographical ordering might not represent key order.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;from&quot;&gt;The first key that could be in the range, where iteration starts from.&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;to&quot;&gt;The last key that could be in the range, where iteration ends.&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;The reverse enumerator for this range, from smallest to largest bytes.&lt;/returns&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;exception cref=&quot;InvalidStateStoreException&quot;&gt;if the store is not initialized&lt;/exception&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IKeyValueEnumerator</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ReverseRange</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="k">from</span><span class="p">,</span><span class="w"> </span><span class="n">Bytes</span><span class="w"> </span><span class="n">to</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Return an enumerator over all keys in this store. No ordering guarantees are provided.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;An enumerator of all key/value pairs in the store.&lt;/returns&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;exception cref=&quot;InvalidStateStoreException&quot;&gt;if the store is not initialized&lt;/exception&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">KeyValuePair</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">All</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Return a reverse enumerator over all keys in this store. No ordering guarantees are provided.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;A reverse enumerator of all key/value pairs in the store.&lt;/returns&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;exception cref=&quot;InvalidStateStoreException&quot;&gt;if the store is not initialized&lt;/exception&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">KeyValuePair</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ReverseAll</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Return an approximate count of key-value mappings in this store.</span>
<span class="w">        </span><span class="c1">/// The count is not guaranteed to be exact in order to accommodate stores</span>
<span class="w">        </span><span class="c1">/// where an exact count is expensive to calculate.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;an approximate count of key-value mappings in the store.&lt;/returns&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">ApproximateNumEntries</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Update the value associated with this key.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;key&quot;&gt;The key to associate the value to&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;value&quot;&gt;The value to update, it can be null if the serialized bytes are also null it is interpreted as deletes&lt;/param&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Put</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Update the value associated with this key, unless a value is already associated with the key.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;key&quot;&gt;The key to associate the value to&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;value&quot;&gt;The value to update, it can be null; if the serialized bytes are also null it is interpreted as deletes&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;The old value or null if there is no such key.&lt;/returns&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">PutIfAbsent</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Update all the given key/value pairs.</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;entries&quot;&gt;A list of entries to put into the store. if the serialized bytes are also null it is interpreted as deletes&lt;/param&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">PutAll</span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">KeyValuePair</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">entries</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">/// &lt;summary&gt;</span>
<span class="w">        </span><span class="c1">/// Delete the value from the store (if there is one).</span>
<span class="w">        </span><span class="c1">/// &lt;/summary&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;param name=&quot;key&quot;&gt;the key&lt;/param&gt;</span>
<span class="w">        </span><span class="c1">/// &lt;returns&gt;The old value or null if there is no such key&lt;/returns&gt;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="n">Bytes</span><span class="w"> </span><span class="n">key</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>2 - Integrate with Streamiz Application</p>
<p>For using the custom state store within your Streamiz application, you need to write a custom <code class="docutils literal notranslate"><span class="pre">IKeyValueBytesStoreSupplier</span></code>. This supplier will be used to create one or multiple instances of your custom store. Of course, you can add some parameters like URI, API Key/Secret, etc ..</p>
<p>For instance :</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomStorageSupplier</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IKeyValueBytesStoreSupplier</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">Token</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="k">set</span><span class="p">;}</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="nf">AzureRemoteStorageSupplier</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri</span><span class="p">;</span>
<span class="w">            </span><span class="n">Token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<span class="w">            </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">IKeyValueStore</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Get</span><span class="p">()</span>
<span class="w">            </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CustomKeyValueStore</span><span class="p">(</span><span class="n">Uri</span><span class="p">,</span><span class="w"> </span><span class="n">Token</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">);</span>

<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">MetricsScope</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;custom-remote-storage&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>3 - Use the supplier</p>
<p>Let’s suppose, you would like to materialize a KTable with your custom state store.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;table-input&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="n">Materialized</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">IKeyValueStore</span><span class="o">&lt;</span><span class="n">Bytes</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="o">&gt;&gt;</span>
<span class="w">                                </span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomStorageSupplier</span><span class="p">(</span><span class="s">&quot;uri://&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;APIZ?ZLAKZ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;custom-store&quot;</span><span class="p">)));</span>
</pre></div>
</div>
</section>
<section id="azure-table-key-value-store">
<h3>Azure Table Key/Value store<a class="headerlink" href="#azure-table-key-value-store" title="Link to this heading"></a></h3>
<p><strong>This feature is available in <code class="docutils literal notranslate"><span class="pre">EARLY</span> <span class="pre">ACCESS</span></code> only.</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">1.7.0</span></code> introduce a new remote storage. The <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">Table</span> <span class="pre">Store</span></code> use under the hood, the Azure Table Client which can be used with a <a class="reference external" href="https://learn.microsoft.com/en-us/azure/storage/tables/table-storage-overview">Table Blob Storage</a> or a <a class="reference external" href="https://learn.microsoft.com/en-us/azure/cosmos-db/table/tutorial-query">CosmosDb endpoint</a></p>
<section id="how-to">
<h4>How to ?<a class="headerlink" href="#how-to" title="Link to this heading"></a></h4>
<p>1- Install this nuget package</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">dotnet</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">Streamiz</span><span class="p">.</span><span class="n">Kafka</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Azure</span><span class="p">.</span><span class="n">RemoteStorage</span>
</pre></div>
</div>
<p>2- Use the helper class to materialize the <code class="docutils literal notranslate"><span class="pre">Azure</span> <span class="pre">Remote</span> <span class="pre">Store</span></code></p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;table-input&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">AzureRemoteStorage</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">());</span>
</pre></div>
</div>
<p>3- Configure it</p>
<p>You can configure the azure endpoint and credentials via two way.</p>
<p>1- Programmaticaly</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span>
<span class="w">                </span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;table-input&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">AzureRemoteStorage</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span>
<span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">AzureRemoteStorageOptions</span>
<span class="w">                                </span><span class="p">{</span>
<span class="w">                                    </span><span class="n">AccountName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">StorageUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                                    </span><span class="n">StorageAccountKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">                                </span><span class="p">}));</span>
</pre></div>
</div>
<p>2- Via Configuration</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamConfig</span><span class="o">&lt;</span><span class="n">StringSerDes</span><span class="p">,</span><span class="w"> </span><span class="n">StringSerDes</span><span class="o">&gt;</span><span class="p">{</span>
<span class="w">                </span><span class="n">ApplicationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$&quot;test-app&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">BootstrapServers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;localhost:9092&quot;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">           </span>
<span class="n">config</span><span class="p">[</span><span class="s">&quot;azure.remote.storage.uri&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;URI&quot;</span><span class="p">;</span>
<span class="n">config</span><span class="p">[</span><span class="s">&quot;azure.remote.storage.account.name&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ACCOUNT_NAME&quot;</span><span class="p">;</span>
<span class="n">config</span><span class="p">[</span><span class="s">&quot;azure.remote.storage.account.key&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MASTER_KEY&quot;</span><span class="p">;</span>

<span class="c1">/// ....</span>
<span class="kt">var</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;table-input&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">AzureRemoteStorage</span><span class="p">.</span><span class="n">As</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">());</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="stateful-processors.html" class="btn btn-neutral float-left" title="Stateful processors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="topology-test-driver.html" class="btn btn-neutral float-right" title="Test topology driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, @LGouellec.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>